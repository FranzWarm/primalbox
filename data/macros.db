{"name":"[blank sheet (Copy)] LBL_BODY_ROLL","type":"script","author":"DbWrP7TYAaOCOn1q","img":"modules/primalbox/icons/body.svg","scope":"global","command":"let rollData = {\n    attrID: \"6nH4dHW3W15a9yl1\",\n    attKey: \"LBL_BODY_ROLL\",\n    citemID: null,\n    citemKey: null,\n    ciRoll: false,\n    isFree: false,\n    tableKey: null,\n    useData: null\n};\n\n// This is the ID the macro was dragged from\n// For checking Free Table ID's\nlet originalActorId = \"lN6AVbrGNJivNaW1\";\n\nconst speaker = ChatMessage.getSpeaker();\nlet actor;\nif (speaker.token) actor = game.actors.tokens[speaker.token];\nif (!actor) actor = game.actors.get(speaker.actor);\nif (actor) {\n    let letsContinue = true;\n    // Check if actor possess the citem\n    if(rollData.citemKey != null)\n        if(!actor.data.data.citems.find(ci => ci.ciKey === rollData.citemKey))\n            return ui.notifications.warn(\"Current actor does not possess the required citem.\");\n\n    // Check if the free table item still exists\n    if(rollData.isFree)\n        if(!actor.data.data.attributes[rollData.tableKey].tableitems.find(ti => ti.id === rollData.citemID))\n            return ui.notifications.warn(\"Current actor does not possess the referenced Free Table id.\");\n        // Check if the selected actor is the original\n        else if (actor.data._id != originalActorId)\n            await Dialog.confirm({\n                title: \"ARE YOU SURE ABOUT THAT?\",\n                content: \"You are about to roll a Free Table id that isn't from the same actor you created the macro from.<br><br>This may have unintended results due to targetting a different id owned by that actor.\",\n                yes: () => {},\n                no: () => {letsContinue = false;},\n                defaultYes: true\n            });\n\n        if(letsContinue)\n            actor.sheet._onRollCheck(\"6nH4dHW3W15a9yl1\", \"LBL_BODY_ROLL\", null, null, false, false, null, null);\n    } else\n    ui.notifications.warn(\"Couldn't find actor. Select a token.\");","folder":null,"sort":0,"permission":{"default":0,"PfJzzNlsx6nRUf8s":3,"DbWrP7TYAaOCOn1q":3},"flags":{},"_id":"hS8lzGwKCQjzS17Z"}
